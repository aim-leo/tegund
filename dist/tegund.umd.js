!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tegund=e():t.tegund=e()}(this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){function n(t){return Object.prototype.toString.call(t)}function i(...t){return!(t.length<2)&&t.every(e=>n(e)===n(t[0]))}function r(t,e){if(!i(e,[]))throw new Error("list expect a "+n([]));let r=!1;for(const n in e)if(i(e[n],t)){r=!0;break}return r}function s(...t){return i(...t,[])}function a(...t){return i(...t,"")}function o(...t){return i(...t,1)&&!h(...t)}function h(...t){return t.every(t=>Number.isNaN(t))}function c(...t){return t.every(t=>r(t,[()=>{},async()=>{}]))}const l=["Boolean","String","Number","Symbol","Promise","NaN","Undefined","Pattern","Function","SyncFunction","AsyncFunction","Date","Set"],u=["Float","Integer","Empty"],d=["Object","Array"],f=[...l,...u,...d],m={isArray:s,isBoolean:function(...t){return i(...t,!0)},isFunction:c,isSyncFunction:function(...t){return t.every(t=>i(t,()=>{}))},isAsyncFunction:function(...t){return t.every(t=>i(t,async()=>{}))},isNaN:h,isNumber:o,isInteger:function(...t){return o(...t)&&t.every(t=>t%1==0)},isFloat:function(...t){return o(...t)&&t.every(t=>t%1!=0)},isString:a,isSymbol:function(...t){return i(...t,Symbol("Symbol"))},isUndefined:function(...t){return i(...t,void 0)},isObject:function(...t){return i(...t,{})},isNull:function(...t){return i(...t,null)},isPromise:function(...t){return i(...t,Promise.resolve())},isPattern:function(...t){return i(...t,/d/)},isDate:function(...t){return t.every(t=>i(t,new Date)&&!h(t.getTime()))},isSet:function(...t){return t.every(t=>i(t,new Set))},isEmpty:function(...t){return t.every(t=>""===t||0===t||null==t||Number.isNaN(t))}};function p(t){if(!a(t))throw console.error("getValidateByType",t),new Error("type expected a string");return m["is"+t]}t.exports={whatType:n,isType:i,inType:r,allValidates:m,...m,baseTypes:l,sugerTypes:u,stuctTypes:d,allTypes:f,getValidateByType:p,getValidateType:function(t){if(!c(t))throw new Error("validate expected a function");return t.name.replace("is","")},assert:function(t,e,i){if(!c(e)){if(a(e)&&(e=[e]),s(e)){for(const n of e){if(!a(n))throw new Error("assert validator expected a string array | string | function");if(p(n)(t))return}throw new Error(i||`obj expected a ${e.join(" | ")} type, but got a ${n(t)}`)}throw new Error("assert validator expected a string array | string | function")}if(!e(t))throw new Error(i||"validate error")}}},function(t,e,n){const{ValidateTypeError:i,ValidateError:r}=n(3),{rangeMixin:s,enumMixin:a,patternMixin:o,dateRangeMixin:h,numberRangeMixin:c,dateMixin:l,stringMixin:u,numberMixin:d,booleanMixin:f}=n(6),{assert:m,isFunction:p,isString:g,getValidateByType:_,isObject:x}=n(0),{objectOverflow:y,format2TypeString:v,format2Type:b}=n(4);class w{constructor(){this._type=null,this._alias=null,this._validate=[],this._transform=[],this._optional=!1,this._context={},Object.assign(this,a)}type(t){if(this._type&&this._type!==t)throw new Error("type can not modify");const e=v(t);return this._type=e,["Number","Integer","Float"].includes(this._type)&&Object.assign(this,c,o,d),"String"===this._type&&Object.assign(this,o,u,s),"Date"===this._type&&Object.assign(this,h,l),"Array"===this._type&&Object.assign(this,s),"Boolean"===this._type&&Object.assign(this,f),this}alias(t){return m(t,"String","alias expected a string"),this._alias=t,this}forbid(t=!0){return m(t,"Boolean"),this.constructor=t?S:w,this}instance(t){return m(t,"SyncFunction"),this.addValidator({name:"InstanceValidator",validator:e=>e instanceof t,message:"data expected instance of parent: "+t.name}),this}or(...t){t=b(...t);const e=new C;return e.or(this,...t),e}transform(...t){if(!p(...t))throw new Error("transform expected one or many function");if(t.length<1)throw new Error("transform expected at least one arg");return this._transform.push(...t),this}setContext(t,e){return m(t,"String","context expected a object"),this._context[t]=e,this}clearContext(t){return t?delete this._context[t]:this._context={},this}addValidator({name:t,validator:e,message:n}){if(m(e,"Function"),n&&!g(n)&&!p(n))throw new Error("message expected a string || function");return t&&m(t,"String"),t&&this.removeValidator(t),this._validate.push({validator:e,message:n,name:t}),this}removeValidator(t){m(t,"String"),m(t,t=>!!t);const e=this._validate.map(t=>t.name).indexOf(t);-1!==e&&this._validate.splice(e,1)}test(...t){let e=null;try{e=function(){if(this.constructor===S)return t.length>0?new r({message:"this field is not allow to entered"}):void 0;if(0===t.length)return new r({message:`None is not a ${this._type} type`});for(const e in t){let n=t[e];if(this._transform)for(const t of this._transform)if(n=t(n),n instanceof r)return n;if(void 0===n&&this._optional)continue;let s=!1;if(this._type){const t=_(this._type);p(t)&&t(n)&&(s=!0)}else s=!0;if(!s)return new i({source:n,index:e,type:this._type});for(const t of this._validate){const e=t.validator.call(this,n);if(e instanceof r)return e;if(!1===e)return new r({message:t.message,source:n})}}}.call(this)}catch(t){return t}return e}check(...t){return!(this.test(...t)instanceof r)}assert(...t){const e=this.test(...t);if(e instanceof r)throw e}optional(t=!0){return this._optional=t,this}clone(){const t=new w;return Object.assign(t,this),t}}class C extends w{constructor(...t){super(),this._maybeCondition=[],this.or(...t)}or(...t){return b(...t).map(t=>this._maybeCondition.push(t)),this}test(...t){const e=super.test(...t);if(e)return e;const n=t=>{for(const e of this._maybeCondition){if(!e.test(t))return!0}};for(const e of t)if(void 0!==e||!this._optional){if(!(this instanceof $||n(e)))return new r;if(this instanceof $&&n(e))return new r}}clone(){const t=new C;return Object.assign(t,this),t._maybeCondition=this._maybeCondition.map(t=>t.clone()),t}setContext(...t){if(super.setContext(...t),this._maybeCondition)for(const e of this._maybeCondition)e.setContext(...t);return this}clearContext(...t){if(super.clearContext(...t),this._maybeCondition)for(const e of this._maybeCondition)e.clearContext(...t);return this}}class $ extends C{clone(){const t=new $;return Object.assign(t,this),t._maybeCondition=this._maybeCondition.map(t=>t.clone()),t}}class T extends w{constructor(t){super(),this._child=null,this._strict=!1,this.type("Object"),void 0!==t&&this.setChild(t)}setChild(t){if(m(t,"Object"),t instanceof w)return;const e={},i=n(2);for(const n in t){const r=t[n];if(r instanceof w)e[n]=r;else if(g(r))if(r in i)e[n]=i[r]();else{const t=new w;t.type(r),e[n]=t}else Array.isArray(r)?e[n]=new j(r):"object"==typeof r&&(e[n]=new T(r))}this._child=e}testProvided(...t){this.setContext("ignoreUnprovided",!0);const e=this.test(...t);return this.clearContext("ignoreUnprovided"),e}strict(t=!0){return m(t,"Boolean","strict is expected a boolean"),this._strict=t,this}extend(...t){for(let e of t)if(e instanceof T)this._child=Object.assign(this._child||{},e._child);else{if(!x(e))throw new Error("combine expected a object or a ObjectT, but got a "+e);e=new T(e),this._child=Object.assign(this._child||{},e._child)}return this}clone(){const t=new T;Object.assign(t,this);for(const e in this._child)t._child[e]=this._child[e].clone();return t}setContext(...t){if(super.setContext(...t),this._child)for(const e in this._child)this._child[e].setContext(...t);return this}clearContext(...t){if(super.clearContext(...t),this._child)for(const e in this._child)this._child[e].clearContext(...t);return this}test(...t){const e=super.test(...t);if(e)return e;for(const e in t){const n=t[e];if(this._strict){const i=y(n,this._child);if(i)return new r({message:`Cannot set properties other than Shema${t.length>1?", at index:"+e+",":""}, prop: ${i}`})}for(const i in this._child){if(this._context.ignoreUnprovided&&!(i in n))continue;const s=n[i],a=this._child[i];if(!a._optional||n.hasOwnProperty(i)){if(a.constructor===S)return i in n?new r({message:`${t.length>1?"Index:"+e+",":""}field ${i} is not allow to entered`}):void 0;{const n=a.test(s);if(n)return new r({...n,message:`${t.length>1?"Index:"+e+",":""}field ${i} validate error, ${n.message}`})}}}}}}class j extends w{constructor(...t){super(),this._child=null,this._childCate=null,this.type("Array"),t.length>0&&this.setChild(...t)}setChild(...t){if(this._childCate=null,this._child=null,0===t.length)return this;if(1===t.length&&Array.isArray(t[0])){if(0===t[0].length)throw new Error("array struct should not be empty");this._child=[];for(const e in t[0]){const n=t[0][e];if(void 0===n)continue;const i=b(n)[0];if(!(i instanceof w))throw new Error("every item of array should be a T");this._child[e]=i}return this}const e=b(...t);for(const t of e)if(!(t instanceof w))throw new Error("every item of array should be a T");return this._childCate=1===t.length?e[0]:new C(...e),this}test(...t){const e=super.test(...t);if(e)return e;if(this._child)for(const e of t)for(const t in this._child){const n=this._child[t];if(!n)continue;const i=n.test(e[t]);if(i)return i}if(this._childCate)for(const e of t){if(0===e.length)continue;const t=this._childCate.test(...e);if(t)return t}}clone(){const t=new j;Object.assign(t,this);for(const e in this._child)t._child[e]=this._child[e].clone();return Array.isArray(this._childCate)?t._childCate=this._childCate.map(t=>t.clone()):this._childCate instanceof w&&(t._childCate=this._childCate.clone()),t}setContext(...t){return super.setContext(...t),this._childCate?this._childCate.setContext(...t):this._child&&this._child.map(e=>e.setContext(...t)),this}clearContext(...t){return super.clearContext(...t),this._childCate?this._childCate.clearContext(...t):this._child&&this._child.map(e=>e.clearContext(...t)),this}}class S extends w{clone(){const t=new S;return Object.assign(t,this),t}}t.exports={T:w,ObjectT:T,ArrayT:j,NotAtT:$,AtT:C,NeverT:S}},function(t,e,n){const{allTypes:i}=n(0),{T:r,ObjectT:s,ArrayT:a,NotAtT:o,AtT:h,NeverT:c}=n(1),l={defineType:u,at:(...t)=>new h(...t),notat:(...t)=>new o(...t)};u("any",new r),u("never",new c);for(const t of i){u(t.toLowerCase(),(...e)=>{const n=new("Object"===t?s:"Array"===t?a:r)(...e);return n.type(t),n})}function u(t,e){return l[t]="function"==typeof e?e:()=>e.clone(),l[t]}u("func",l.function),u("id",()=>l.string().clone().convert().addValidator({name:"MongoObjectIdValidator",validator:t=>Boolean(t)&&!Array.isArray(t)&&/^[0-9a-fA-F]{24}$/.test(String(t)),message:"expect a valid mongo object id"})),t.exports=l},function(t,e,n){const{isString:i,whatType:r,isFunction:s}=n(0);class a extends Error{constructor({message:t="validate error!",source:e}={}){super(t),i(t)||s(t)||console.error("message expected a string || function"),this.status=400,this.message="function"==typeof t?t(e):t,this.source=e,this.name="ValidateError"}}t.exports={ValidateError:a,ValidateTypeError:class extends a{constructor({type:t,message:e,field:n,...i}={}){super(i),this.type=t,this.name="ValidateTypeError",this.message=`${n?n+"is":""}expected a ${t} type, got a ${r(this.source)}`}}}},function(t,e,n){const{assert:i,isUndefined:r,isNull:s,isNaN:a,isArray:o,isString:h}=n(0);t.exports={objectOverflow:function(t,e){for(const n in t)if(!(n in e))return n},relateDate:function(t,e){i(t,"Date"),i(e,"Date");const n=t.getTime(),r=e.getTime();return n===r?0:n<r?-1:1},formatDate:function(t){return i(t,"Date"),t.toISOString()},defineUnEnumerableProperty:function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0})},removeEmpty:function(t,{removeUndefined:e=!0,removeNull:n=!0,removeNaN:h=!1,removeEmptyString:c=!1,removeEmptyArray:l=!1,removeFalse:u=!1}={}){i(t,"Object");const d={};for(const i in t){const f=t[i];e&&r(f)||(n&&s(f)||h&&a(f)||c&&""===f||l&&o(f)&&0===f.length||u&&!1===f||(d[i]=f))}return d},format2TypeString:function(t){const{T:e}=n(1);return t instanceof e?t._type:h(t)?t:void 0},format2Type:function(...t){const{T:e}=n(1),i=n(2),r=[];for(const n of t)if(n instanceof e)r.push(n);else{if(!h(n)||!(n in i))throw new Error("type is not a valid T || t alias");r.push(i[n]())}return r}}},function(t,e,n){const i=n(2),r=n(1),s=n(3),{allValidates:a,getValidateByType:o,assert:h}=n(0),{defineUnEnumerableProperty:c,removeEmpty:l}=n(4);t.exports={...i,...r,...s,...a,getValidateByType:o,assert:h,defineUnEnumerableProperty:c,removeEmpty:l}},function(t,e,n){const{assert:i,isFunction:r,isDate:s}=n(0),{relateDate:a,formatDate:o}=n(4),{ValidateError:h}=n(3),c={length(t,e){return i(t,"Integer","length expected a integer"),i(t,t=>t>=0,"length expected a integer gte then 0"),this._length=t,this.addValidator({name:"Length",validator:this._validateLength.bind(this),message:e||(t=>`expected a ${this._type}, length at ${this._length}, but got a length: ${t.length}`)}),this},min(t,e){return i(t,"Integer","min expected a integer"),i(t,t=>t>0,"min expected a integer gte then 0"),this._max&&i(t,t=>t<=this._max,"min expected a integer lte then max: "+this._max),this._min=t,this.addValidator({name:"Min",validator:this._validateMin.bind(this),message:e||(t=>`expected a ${this._type}, length gte than ${this._min}, but got a length: ${t.length}`)}),this},max(t,e){return i(t,"Integer","max expected a integer"),i(t,t=>t>0,"max expected a integer gte then 0"),this._min&&i(t,t=>t>=this._min,"min expected a integer lte then max: "+this._min),this._max=t,this.addValidator({name:"Max",validator:this._validateMax.bind(this),message:e||(t=>`expected a ${this._type}, length lte than ${this._max}, but got a length: ${t.length}`)}),this},_validateLength(t){if(void 0!==this._length&&["String","Array"].includes(this._type))return t.length===this._length},_validateMin(t){if(void 0!==this._min&&["String","Array"].includes(this._type))return t.length>=this._min},_validateMax(t){if(void 0!==this._max&&["String","Array"].includes(this._type))return t.length<=this._max}},l={min(t,e){return i(t,"Integer","min expected a integer"),this._max&&i(t,t=>t<=this._max,"min expected a integer lte then max: "+this._max),this._min=t,this.addValidator({name:"Min",validator:this._validateMin.bind(this),message:e||(t=>`expected a ${this._type}, value gte than ${this._min}, but got a: ${t}`)}),this},max(t,e){return i(t,"Integer","max expected a integer"),this._min&&i(t,t=>t>=this._min,"min expected a value integer lte then max: "+this._min),this._max=t,this.addValidator({name:"Max",validator:this._validateMax.bind(this),message:e||(t=>`expected a ${this._type}, value lte than ${this._max}, but got a: ${t}`)}),this},_validateMin(t){if(void 0!==this._min&&["Number","Integer","Float"].includes(this._type))return t>=this._min},_validateMax(t){if(void 0!==this._max&&["Number","Integer","Float"].includes(this._type))return t<=this._max}},u={min(t,e){return i(t,"Date","min expected a date"),this._max&&i(t,t=>-1===a(t,this._max),`min scope expected a date before ${o(this._max)}, but got a ${o(t)}`),this._min=t,this.addValidator({name:"Min",validator:this._validateMin.bind(this),message:e||(t=>`expected a date after ${o(this._min)}, but got a ${o(t)}`)}),this},max(t,e){return i(t,"Date","max expected a date"),this._min&&i(t,t=>1===a(t,this._min),`max scope expected a date after ${o(this._min)}, but got a ${o(t)}`),this._max=t,this.addValidator({name:"Max",validator:this._validateMax.bind(this),message:e||(t=>`expected a date before ${o(this._max)}, but got a ${o(t)}`)}),this},_validateMin(t){if(void 0!==this._min)return-1!==a(t,this._min)},_validateMax(t){if(void 0!==this._max)return 1!==a(t,this._max)}},d={enum(t,e){if(i(t,"Array","enum expected a array"),r(this.check)){const e=this.test(...t);if(e)throw e}return this._enum=t,this.addValidator({name:"Enum",validator:this._validateEnum.bind(this),message:e||(t=>`expected a data value at ${this._enum}, but got a ${t}`)}),this},_validateEnum(t){if(void 0!==this._enum)return this._enum.includes(t)}},f={pattern(t,e){return i(t,"Pattern","pattern expected a reg"),this._pattern=t,this.addValidator({name:"Pattern",validator:this._validatePattern.bind(this),message:e||`expected a data match pattern: /${this._pattern.source}/${this._pattern.flags}`}),this},_validatePattern(t){if(void 0!==this._pattern&&["String","Number"].includes(this._type))return this._pattern.test(t)}},m={parseInt(){return this.transform(parseInt)},parseFloat(){return this.transform(parseFloat)},convert(){return this.transform(t=>Number(t))},positive(){return this.addValidator({name:"numberPositive",validator:t=>t>0,message:"the value must be greater than 0"})},negative(){return this.addValidator({name:"numberNegative",validator:t=>t<0,message:"the value must be less than 0"})}},p={convert(){return this.transform(t=>String(t))},lowerCase(){return this.transform(t=>String(t).toLowerCase())},upperCase(){return this.transform(t=>String(t).toUpperCase())},trim(){return this.transform(t=>String(t).trim())},trimLeft(){return this.transform(t=>String(t).trimLeft())},trimRight(){return this.transform(t=>String(t).trimRight())},normalize(){return this.transform(t=>String(t).trim().toLowerCase())},numeric(){return this.pattern(/^-?[0-9]\d*(\.\d+)?$/,"the value must be an numeric string")},alpha(){return this.pattern(/^[a-zA-Z]+$/,"the value must be an alphabetic string")},alphaNumeric(){return this.pattern(/^[a-zA-Z0-9]+$/,"the value must be an alphanumeric string")},hex(){return this.pattern(/^[0-9a-fA-F]+$/,"the value must be an hex string")},base64(){return this.pattern(/^(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?$/,"the value must be an base64 string.")},contain(t){return i(t,"String"),this.addValidator({name:"stringContain",validator:e=>-1!==e.indexOf(t),message:"the value must contain "+t})}},g={convert(){return this.transform(t=>!!t)}},_={convert(){return this.transform(t=>{if(s(t))return t;const e=new Date(t);return s(e)?e:new h({message:`date convert error: ${t} can not convert to a valid Date`})})}};t.exports={rangeMixin:c,enumMixin:d,patternMixin:f,dateRangeMixin:u,numberRangeMixin:l,stringMixin:p,numberMixin:m,dateMixin:_,booleanMixin:g}}])}));